#include <stdio.h>
#include <string.h>
#include <stdlib.h>

// Cria a resposta HTML em um buffer maior
char html[32768]; // 32KB - tamanho para HTML completo

extern char html[32768];

// Preenche o array html com o conteúdo do painel de controle do armazém
void preencher_html() {
    snprintf(html, sizeof(html),
        "HTTP/1.1 200 OK\r\n"
        "Content-Type: text/html\r\n"
        "\r\n"
        "<!DOCTYPE html>\n"
        "<html lang=\"pt-BR\">\n"
        "<head>\n"
        "    <meta charset=\"UTF-8\">\n"
        "    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n"
        "    <title>Painel de Controle - Armazém XYZ</title>\n"
        "    \n"
        "    <style>\n"
        "        :root{--cor-primaria:#005A9C;--cor-fundo:#f4f7f9;--cor-painel:#ffffff;--cor-texto:#333333;--cor-sucesso:#28a745;--cor-aviso:#ffc107;--cor-borda:#dee2e6;--sombra-suave:0 4px 8px rgba(0,0,0,0.05)}\n"
        "\n"
        "        *{margin:0;padding:0;box-sizing:border-box}\n"
        "        body{font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,sans-serif;background-color:var(--cor-fundo);color:var(--cor-texto);line-height:1.6}\n"
        "\n"
        "        .main-header, .main-footer {\n"
        "            background-color: var(--cor-primaria);\n"
        "            color: white;\n"
        "            padding: 1rem 2rem;\n"
        "            text-align: center;\n"
        "        }\n"
        "\n"
        "        .dashboard-container {\n"
        "            display: flex;\n"
        "            flex-wrap: wrap; \n"
        "            padding: 1.5rem;\n"
        "            gap: 1.5rem;\n"
        "        }\n"
        "\n"
        "        .warehouse-view-column {\n"
        "            flex: 2; \n"
        "            min-width: 350px;\n"
        "        }\n"
        "\n"
        "        .controls-column {\n"
        "            flex: 1; \n"
        "            min-width: 300px;\n"
        "        }\n"
        "\n"
        "        section {\n"
        "            background-color: var(--cor-painel);\n"
        "            padding: 1.5rem;\n"
        "            border-radius: 8px;\n"
        "            box-shadow: var(--sombra-suave);\n"
        "            margin-bottom: 1.5rem;\n"
        "        }\n"
        "\n"
        "        h2, h3 {\n"
        "            margin-bottom: 1rem;\n"
        "            color: var(--cor-primaria);\n"
        "        }\n"
        "        h3 {\n"
        "            font-size: 1.1rem;\n"
        "            border-bottom: 1px solid var(--cor-borda);\n"
        "            padding-bottom: 0.5rem;\n"
        "        }\n"
        "\n"
        "        .warehouse-layout {\n"
        "            display: flex;\n"
        "            align-items: center;\n"
        "            justify-content: center;\n"
        "            gap: 1rem;\n"
        "        }\n"
        "        \n"
        "        .rack-container {\n"
        "            display: grid;\n"
        "            grid-template-columns: repeat(5, 1fr);\n"
        "            gap: 0.5rem;\n"
        "            flex-grow: 1;\n"
        "        }\n"
        "\n"
        "        .rack-cell {\n"
        "            background-color: #e9ecef;\n"
        "            border: 1px solid #ccc;\n"
        "            border-radius: 4px;\n"
        "            aspect-ratio: 1 / 1; \n"
        "            display: flex;\n"
        "            align-items: center;\n"
        "            justify-content: center;\n"
        "            font-weight: bold;\n"
        "            font-size: 0.9rem;\n"
        "            transition: background-color 0.3s ease;\n"
        "            cursor: pointer;\n"
        "        }\n"
        "        \n"
        "        .rack-cell.occupied {\n"
        "            background-color: var(--cor-aviso);\n"
        "            color: var(--cor-texto);\n"
        "            border-color: #e6a800;\n"
        "        }\n"
        "\n"
        "        .rack-cell.occupied:hover {\n"
        "            background-color: #e6a800;\n"
        "            transform: scale(1.05);\n"
        "        }\n"
        "\n"
        "        .rack-cell:not(.occupied) {\n"
        "            cursor: not-allowed;\n"
        "            opacity: 0.6;\n"
        "        }\n"
        "\n"
        "        .legend {\n"
        "            display: flex;\n"
        "            justify-content: center;\n"
        "            gap: 2rem;\n"
        "            margin-top: 1rem;\n"
        "            padding: 1rem;\n"
        "            background-color: #f8f9fa;\n"
        "            border-radius: 4px;\n"
        "        }\n"
        "\n"
        "        .legend-item {\n"
        "            display: flex;\n"
        "            align-items: center;\n"
        "            gap: 0.5rem;\n"
        "        }\n"
        "\n"
        "        .legend-color {\n"
        "            width: 20px;\n"
        "            height: 20px;\n"
        "            border-radius: 4px;\n"
        "            border: 1px solid #ccc;\n"
        "        }\n"
        "\n"
        "        .legend-color.occupied {\n"
        "            background-color: var(--cor-aviso);\n"
        "        }\n"
        "\n"
        "        .legend-color.empty {\n"
        "            background-color: #e9ecef;\n"
        "        }\n"
        "\n"
        "        .conveyor {\n"
        "            border: 2px dashed var(--cor-primaria);\n"
        "            padding: 1rem 0.5rem;\n"
        "            min-height: 200px;\n"
        "            display: flex;\n"
        "            flex-direction: column;\n"
        "            align-items: center;\n"
        "            text-align: center;\n"
        "        }\n"
        "        .pallet-info {\n"
        "            margin-top: 1rem;\n"
        "            font-weight: bold;\n"
        "            color: var(--cor-sucesso);\n"
        "        }\n"
        "\n"
        "        .control-group {\n"
        "            margin-bottom: 2rem;\n"
        "        }\n"
        "\n"
        "        form {\n"
        "            display: flex;\n"
        "            flex-direction: column;\n"
        "            gap: 0.75rem;\n"
        "        }\n"
        "        \n"
        "        input[type=\"text\"], input[type=\"number\"], input[type=\"date\"] {\n"
        "            width: 100%;\n"
        "            padding: 0.75rem;\n"
        "            border: 1px solid var(--cor-borda);\n"
        "            border-radius: 4px;\n"
        "            font-size: 1rem;\n"
        "        }\n"
        "\n"
        "        button {\n"
        "            padding: 0.75rem 1rem;\n"
        "            border: none;\n"
        "            border-radius: 4px;\n"
        "            background-color: var(--cor-primaria);\n"
        "            color: white;\n"
        "            font-size: 1rem;\n"
        "            font-weight: bold;\n"
        "            cursor: pointer;\n"
        "            transition: background-color 0.2s ease;\n"
        "        }\n"
        "\n"
        "        button:hover {\n"
        "            background-color: #004a80;\n"
        "        }\n"
        "\n"
        "        #electromagnet-control {\n"
        "            margin-top: 1rem;\n"
        "            display: flex;\n"
        "            align-items: center;\n"
        "            gap: 1rem;\n"
        "        }\n"
        "\n"
        "        #log-container {\n"
        "            background-color: #f8f9fa;\n"
        "            border: 1px solid var(--cor-borda);\n"
        "            border-radius: 4px;\n"
        "            padding: 1rem;\n"
        "            height: 150px;\n"
        "            overflow-y: auto;\n"
        "            font-family: \"Courier New\", monospace;\n"
        "            font-size: 0.9rem;\n"
        "        }\n"
        "        #log-container p {\n"
        "            padding-bottom: 0.5rem;\n"
        "            border-bottom: 1px solid #eee;\n"
        "        }\n"
        "        #log-container p:last-child {\n"
        "            border-bottom: none;\n"
        "        }\n"
        "\n"
        "        .popup-overlay {\n"
        "            position: fixed;\n"
        "            top: 0;\n"
        "            left: 0;\n"
        "            width: 100%;\n"
        "            height: 100%;\n"
        "            background-color: rgba(0, 0, 0, 0.5);\n"
        "            display: none;\n"
        "            justify-content: center;\n"
        "            align-items: center;\n"
        "            z-index: 1000;\n"
        "        }\n"
        "\n"
        "        .popup {\n"
        "            background-color: white;\n"
        "            padding: 2rem;\n"
        "            border-radius: 8px;\n"
        "            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n"
        "            text-align: center;\n"
        "            max-width: 400px;\n"
        "            width: 90%;\n"
        "        }\n"
        "\n"
        "        .popup h3 {\n"
        "            margin-bottom: 1rem;\n"
        "            color: var(--cor-primaria);\n"
        "        }\n"
        "\n"
        "        .popup-buttons {\n"
        "            display: flex;\n"
        "            gap: 1rem;\n"
        "            justify-content: center;\n"
        "            margin-top: 1.5rem;\n"
        "        }\n"
        "\n"
        "        .popup-buttons button {\n"
        "            padding: 0.5rem 1.5rem;\n"
        "        }\n"
        "\n"
        "        .popup-buttons button.cancel {\n"
        "            background-color: #6c757d;\n"
        "        }\n"
        "\n"
        "        .popup-buttons button.cancel:hover {\n"
        "            background-color: #5a6268;\n"
        "        }\n"
        "    </style>\n"
        "</head>\n"
        "<body>\n"
        "\n"
        "    <header class=\"main-header\">\n"
        "        <h1>Painel de Controle - Armazém Automatizado XYZ</h1>\n"
        "    </header>\n"
        "\n"
        "    <main class=\"dashboard-container\">\n"
        "\n"
        "        <div class=\"warehouse-view-column\">\n"
        "            <section id=\"visualizacao-rack\">\n"
        "                <h2>Layout do Armazém</h2>\n"
        "                <div class=\"warehouse-layout\">\n"
        "                    \n"
        "                    <div id=\"entry-conveyor\" class=\"conveyor\">\n"
        "                        <h3>Entrada</h3>\n"
        "                        <div class=\"pallet-info\" id=\"pallet-on-entry\">\n"
        "                            <p>ID: ABC-123</p> \n"
        "                        </div>\n"
        "                    </div>\n"
        "\n"
        "                    <div class=\"rack-container\">\n"
        "                        <div class=\"rack-cell occupied\" data-position=\"A1\">A1</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"A2\">A2</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"A3\">A3</div>\n"
        "                        <div class=\"rack-cell occupied\" data-position=\"A4\">A4</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"A5\">A5</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"B1\">B1</div>\n"
        "                        <div class=\"rack-cell occupied\" data-position=\"B2\">B2</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"B3\">B3</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"B4\">B4</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"B5\">B5</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"C1\">C1</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"C2\">C2</div>\n"
        "                        <div class=\"rack-cell occupied\" data-position=\"C3\">C3</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"C4\">C4</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"C5\">C5</div>\n"
        "                        <div class=\"rack-cell occupied\" data-position=\"D1\">D1</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"D2\">D2</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"D3\">D3</div>\n"
        "                        <div class=\"rack-cell occupied\" data-position=\"D4\">D4</div>\n"
        "                        <div class=\"rack-cell\" data-position=\"D5\">D5</div>\n"
        "                    </div>\n"
        "                    \n"
        "                    <div id=\"exit-conveyor\" class=\"conveyor\">\n"
        "                        <h3>Saída</h3>\n"
        "                         <div class=\"pallet-info\" id=\"pallet-on-exit\">\n"
        "                            </div>\n"
        "                    </div>\n"
        "\n"
        "                </div>\n"
        "                \n"
        "                <div class=\"legend\">\n"
        "                    <div class=\"legend-item\">\n"
        "                        <div class=\"legend-color occupied\"></div>\n"
        "                        <span>Ocupado (com pallet armazenado)</span>\n"
        "                    </div>\n"
        "                    <div class=\"legend-item\">\n"
        "                        <div class=\"legend-color empty\"></div>\n"
        "                        <span>Vazio (sem pallet)</span>\n"
        "                    </div>\n"
        "                </div>\n"
        "            </section>\n"
        "        </div>\n"
        "\n"
        "        <div class=\"controls-column\">\n"
        "            <section id=\"painel-controle\">\n"
        "                <h2>Painel de Controle</h2>\n"
        "\n"
        "                <div class=\"control-group\" id=\"pallet-operations\">\n"
        "                    <h3>Operações com Pallets</h3>\n"
        "                    <form id=\"store-form\">\n"
        "                        <p>Armazenar pallet da esteira de entrada.</p>\n"
        "                        <button type=\"submit\">Iniciar Armazenamento</button>\n"
        "                    </form>\n"
        "                    <form id=\"retrieve-form\">\n"
        "                        <label for=\"pallet-position-input\">Retirar pallet da posição:</label>\n"
        "                        <input type=\"text\" id=\"pallet-position-input\" name=\"position\" placeholder=\"Ex: B3\" required>\n"
        "                        <button type=\"submit\">Iniciar Retirada</button>\n"
        "                    </form>\n"
        "                </div>\n"
        "\n"
        "                <div class=\"control-group\" id=\"manual-control\">\n"
        "                    <h3>Controle Manual</h3>\n"
        "                    <form id=\"move-form\">\n"
        "                        <label for=\"coord-x\">Eixo X:</label>\n"
        "                        <input type=\"number\" id=\"coord-x\" name=\"x\" min=\"0\" value=\"0\">\n"
        "                        <label for=\"coord-y\">Eixo Y:</label>\n"
        "                        <input type=\"number\" id=\"coord-y\" name=\"y\" min=\"0\" value=\"0\">\n"
        "                        <label for=\"coord-z\">Eixo Z:</label>\n"
        "                        <input type=\"number\" id=\"coord-z\" name=\"z\" min=\"0\" value=\"0\">\n"
        "                        <button type=\"submit\">Mover para Coordenada</button>\n"
        "                    </form>\n"
        "                    <div id=\"electromagnet-control\">\n"
        "                         <button id=\"electromagnet-toggle-btn\">Ativar Eletroímã</button>\n"
        "                         <span>Status: <b id=\"electromagnet-status\">Desativado</b></span>\n"
        "                    </div>\n"
        "                </div>\n"
        "            </section>\n"
        "            \n"
        "            <section id=\"historico\">\n"
        "                <h2>Histórico de Movimentações</h2>\n"
        "                <form id=\"history-filter-form\">\n"
        "                    <label for=\"filter-date\">Filtrar por data:</label>\n"
        "                    <input type=\"date\" id=\"filter-date\" name=\"date\">\n"
        "                    <button type=\"submit\">Filtrar</button>\n"
        "                </form>\n"
        "                <div id=\"log-container\">\n"
        "                    <p>15:00:12 - Pallet XYZ-789 retirado da posição A2.</p>\n"
        "                    <p>14:58:34 - Mecanismo movido para X:150 Y:300 Z:50.</p>\n"
        "                    <p>14:55:01 - Pallet ABC-123 armazenado na posição A5.</p>\n"
        "                </div>\n"
        "            </section>\n"
        "        </div>\n"
        "\n"
        "    </main>\n"
        "\n"
        "    <div class=\"popup-overlay\" id=\"popup-overlay\">\n"
        "        <div class=\"popup\">\n"
        "            <h3>Confirmar Remoção</h3>\n"
        "            <p>Deseja remover o pallet da posição <span id=\"popup-position\"></span>?</p>\n"
        "            <div class=\"popup-buttons\">\n"
        "                <button id=\"confirm-remove\">Sim</button>\n"
        "                <button class=\"cancel\" id=\"cancel-remove\">Não</button>\n"
        "            </div>\n"
        "        </div>\n"
        "    </div>\n"
        "\n"
        "    <footer class=\"main-footer\">\n"
        "        <p>Interface de Controle v1.0 - Status do Sistema: <span id=\"system-status\">Online</span></p>\n"
        "    </footer>\n"
        "\n"
        "    <script>\n"
        "        document.addEventListener('DOMContentLoaded', function() {\n"
        "            const rackCells = document.querySelectorAll('.rack-cell');\n"
        "            const popupOverlay = document.getElementById('popup-overlay');\n"
        "            const popupPosition = document.getElementById('popup-position');\n"
        "            const confirmButton = document.getElementById('confirm-remove');\n"
        "            const cancelButton = document.getElementById('cancel-remove');\n"
        "            const electromagnetBtn = document.getElementById('electromagnet-toggle-btn');\n"
        "            const electromagnetStatus = document.getElementById('electromagnet-status');\n"
        "            let currentSlot = null;\n"
        "            let electromagnetActive = false;\n"
        "\n"
        "            rackCells.forEach(cell => {\n"
        "                cell.addEventListener('click', function() {\n"
        "                    if (this.classList.contains('occupied')) {\n"
        "                        currentSlot = this.getAttribute('data-position');\n"
        "                        popupPosition.textContent = currentSlot;\n"
        "                        popupOverlay.style.display = 'flex';\n"
        "                    }\n"
        "                });\n"
        "            });\n"
        "\n"
        "            confirmButton.addEventListener('click', function() {\n"
        "                if (currentSlot) {\n"
        "                    const url = new URL(window.location);\n"
        "                    url.searchParams.set('slot', currentSlot);\n"
        "                    window.location.href = url.toString();\n"
        "                }\n"
        "                popupOverlay.style.display = 'none';\n"
        "            });\n"
        "\n"
        "            cancelButton.addEventListener('click', function() {\n"
        "                popupOverlay.style.display = 'none';\n"
        "                currentSlot = null;\n"
        "            });\n"
        "\n"
        "            popupOverlay.addEventListener('click', function(e) {\n"
        "                if (e.target === popupOverlay) {\n"
        "                    popupOverlay.style.display = 'none';\n"
        "                    currentSlot = null;\n"
        "                }\n"
        "            });\n"
        "\n"
        "            function updateElectromagnetStatus() {\n"
        "                fetch('/electromagnet-status')\n"
        "                    .then(response => response.json())\n"
        "                    .then(data => {\n"
        "                        electromagnetActive = data.active;\n"
        "                        electromagnetStatus.textContent = data.status;\n"
        "                        electromagnetBtn.textContent = electromagnetActive ? 'Desativar Eletroímã' : 'Ativar Eletroímã';\n"
        "                    })\n"
        "                    .catch(error => console.error('Erro ao obter status:', error));\n"
        "            }\n"
        "\n"
        "            electromagnetBtn.addEventListener('click', function() {\n"
        "                const url = new URL(window.location);\n"
        "                url.searchParams.set('electromagnet', 'toggle');\n"
        "                window.location.href = url.toString();\n"
        "            });\n"
        "\n"
        "            updateElectromagnetStatus();\n"
        "        });\n"
        "    </script>\n"
        "\n"
        "</body>\n"
        "</html>\n"
    );
}